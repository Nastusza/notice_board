"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var nativescript_google_maps_sdk_1 = require("nativescript-google-maps-sdk");
var navigation_service_1 = require("~/services/navigation-service");
var offers_service_1 = require("~/services/offers-service");
var marker_custom_1 = require("./components/marker-custom");
var ViewModel = require("./map-module");
var vm = new ViewModel();
function onNavigatingTo(args) {
    var page = args.object;
    page.bindingContext = vm;
}
exports.onNavigatingTo = onNavigatingTo;
function navigateHome(args) {
    navigation_service_1.default.ToHome();
}
exports.navigateHome = navigateHome;
function onMapReady(args) {
    var mapView = args.object;
}
exports.onMapReady = onMapReady;
function onMarkerSelect(args) {
    var marker = args.marker;
    var map = args.object;
}
exports.onMarkerSelect = onMarkerSelect;
function onCameraChanged(args) {
    var camera = args.camera;
    var map = args.object;
    var latMin = map.projection.visibleRegion.bounds.southwest.latitude;
    var latMax = map.projection.visibleRegion.bounds.northeast.latitude;
    var lngMin = map.projection.visibleRegion.bounds.southwest.longitude;
    var lngMax = map.projection.visibleRegion.bounds.northeast.longitude;
    vm.fetching = true;
    map.removeAllMarkers();
    new offers_service_1.OffersService().loadOffers(latMin, latMax, lngMin, lngMax)
        .then(function (result) {
        result.forEach(function (r) { return placeMarker(r, map); });
        vm.fetching = false;
    }, function (error) {
        vm.fetching = false;
    });
}
exports.onCameraChanged = onCameraChanged;
function placeMarker(offer, mapView) {
    var marker = new marker_custom_1.MarkerCustom();
    marker.position = nativescript_google_maps_sdk_1.Position.positionFromLatLng(offer.location.lat, offer.location.lng);
    marker.title = offer.title;
    marker.snippet = offer.description;
    // marker.userData = { index : 1};
    mapView.addMarker(marker);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNkVBQW1IO0FBRW5ILG9FQUE4RDtBQUM5RCw0REFBMEQ7QUFHMUQsNERBQTBEO0FBRTFELElBQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUUxQyxJQUFJLEVBQUUsR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDO0FBRXpCLFNBQWdCLGNBQWMsQ0FBQyxJQUFtQjtJQUM5QyxJQUFNLElBQUksR0FBUyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQy9CLElBQUksQ0FBQyxjQUFjLEdBQUcsRUFBRSxDQUFDO0FBQzdCLENBQUM7QUFIRCx3Q0FHQztBQUVELFNBQWdCLFlBQVksQ0FBQyxJQUFlO0lBQ3hDLDRCQUFpQixDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQy9CLENBQUM7QUFGRCxvQ0FFQztBQUVELFNBQWdCLFVBQVUsQ0FBQyxJQUFlO0lBQ3RDLElBQUksT0FBTyxHQUFZLElBQUksQ0FBQyxNQUFNLENBQUM7QUFDdkMsQ0FBQztBQUZELGdDQUVDO0FBRUQsU0FBZ0IsY0FBYyxDQUFDLElBQXFCO0lBQ2hELElBQU0sTUFBTSxHQUFXLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDbkMsSUFBTSxHQUFHLEdBQVksSUFBSSxDQUFDLE1BQU0sQ0FBQztBQUNyQyxDQUFDO0FBSEQsd0NBR0M7QUFFRCxTQUFnQixlQUFlLENBQUMsSUFBcUI7SUFDakQsSUFBTSxNQUFNLEdBQVcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNuQyxJQUFNLEdBQUcsR0FBWSxJQUFJLENBQUMsTUFBTSxDQUFDO0lBRWpDLElBQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO0lBQ3RFLElBQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO0lBQ3RFLElBQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDO0lBQ3ZFLElBQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDO0lBRXZFLEVBQUUsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO0lBQ25CLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBRXZCLElBQUksOEJBQWEsRUFBRSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUM7U0FDekQsSUFBSSxDQUNELFVBQUMsTUFBb0I7UUFDakIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLFdBQVcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQW5CLENBQW1CLENBQUMsQ0FBQTtRQUN4QyxFQUFFLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztJQUN4QixDQUFDLEVBQ0QsVUFBQyxLQUFLO1FBQ0YsRUFBRSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDeEIsQ0FBQyxDQUFDLENBQUM7QUFDZixDQUFDO0FBckJELDBDQXFCQztBQUVELFNBQVMsV0FBVyxDQUFDLEtBQVksRUFBRSxPQUFnQjtJQUMvQyxJQUFJLE1BQU0sR0FBRyxJQUFJLDRCQUFZLEVBQUUsQ0FBQztJQUNoQyxNQUFNLENBQUMsUUFBUSxHQUFHLHVDQUFRLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN0RixNQUFNLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7SUFDM0IsTUFBTSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDO0lBQ25DLGtDQUFrQztJQUVsQyxPQUFPLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzlCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDYW1lcmEsIENhbWVyYUV2ZW50RGF0YSwgTWFwVmlldywgTWFya2VyLCBNYXJrZXJFdmVudERhdGEsIFBvc2l0aW9uIH0gZnJvbSAnbmF0aXZlc2NyaXB0LWdvb2dsZS1tYXBzLXNkayc7XG5pbXBvcnQgeyBFdmVudERhdGEsIE5hdmlnYXRlZERhdGEsIFBhZ2UgfSBmcm9tICd0bnMtY29yZS1tb2R1bGVzL3VpL3BhZ2UvcGFnZSc7XG5pbXBvcnQgTmF2aWdhdGlvblNlcnZpY2UgZnJvbSAnfi9zZXJ2aWNlcy9uYXZpZ2F0aW9uLXNlcnZpY2UnO1xuaW1wb3J0IHsgT2ZmZXJzU2VydmljZSB9IGZyb20gJ34vc2VydmljZXMvb2ZmZXJzLXNlcnZpY2UnO1xuaW1wb3J0IHsgT2ZmZXIgfSBmcm9tICd+L3NoYXJlZC9pbnRlcmZhY2VzJztcblxuaW1wb3J0IHsgTWFya2VyQ3VzdG9tIH0gZnJvbSAnLi9jb21wb25lbnRzL21hcmtlci1jdXN0b20nO1xuXG5jb25zdCBWaWV3TW9kZWwgPSByZXF1aXJlKFwiLi9tYXAtbW9kdWxlXCIpO1xuXG5sZXQgdm0gPSBuZXcgVmlld01vZGVsKCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBvbk5hdmlnYXRpbmdUbyhhcmdzOiBOYXZpZ2F0ZWREYXRhKSB7XG4gICAgY29uc3QgcGFnZSA9IDxQYWdlPmFyZ3Mub2JqZWN0O1xuICAgIHBhZ2UuYmluZGluZ0NvbnRleHQgPSB2bTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5hdmlnYXRlSG9tZShhcmdzOiBFdmVudERhdGEpIHtcbiAgICBOYXZpZ2F0aW9uU2VydmljZS5Ub0hvbWUoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9uTWFwUmVhZHkoYXJnczogRXZlbnREYXRhKSB7XG4gICAgdmFyIG1hcFZpZXcgPSA8TWFwVmlldz5hcmdzLm9iamVjdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9uTWFya2VyU2VsZWN0KGFyZ3M6IE1hcmtlckV2ZW50RGF0YSkge1xuICAgIGNvbnN0IG1hcmtlciA9IDxNYXJrZXI+YXJncy5tYXJrZXI7XG4gICAgY29uc3QgbWFwID0gPE1hcFZpZXc+YXJncy5vYmplY3Q7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvbkNhbWVyYUNoYW5nZWQoYXJnczogQ2FtZXJhRXZlbnREYXRhKSB7XG4gICAgY29uc3QgY2FtZXJhID0gPENhbWVyYT5hcmdzLmNhbWVyYTtcbiAgICBjb25zdCBtYXAgPSA8TWFwVmlldz5hcmdzLm9iamVjdDtcblxuICAgIGNvbnN0IGxhdE1pbiA9IG1hcC5wcm9qZWN0aW9uLnZpc2libGVSZWdpb24uYm91bmRzLnNvdXRod2VzdC5sYXRpdHVkZTtcbiAgICBjb25zdCBsYXRNYXggPSBtYXAucHJvamVjdGlvbi52aXNpYmxlUmVnaW9uLmJvdW5kcy5ub3J0aGVhc3QubGF0aXR1ZGU7XG4gICAgY29uc3QgbG5nTWluID0gbWFwLnByb2plY3Rpb24udmlzaWJsZVJlZ2lvbi5ib3VuZHMuc291dGh3ZXN0LmxvbmdpdHVkZTtcbiAgICBjb25zdCBsbmdNYXggPSBtYXAucHJvamVjdGlvbi52aXNpYmxlUmVnaW9uLmJvdW5kcy5ub3J0aGVhc3QubG9uZ2l0dWRlO1xuXG4gICAgdm0uZmV0Y2hpbmcgPSB0cnVlO1xuICAgIG1hcC5yZW1vdmVBbGxNYXJrZXJzKCk7XG5cbiAgICBuZXcgT2ZmZXJzU2VydmljZSgpLmxvYWRPZmZlcnMobGF0TWluLCBsYXRNYXgsIGxuZ01pbiwgbG5nTWF4KVxuICAgICAgICAudGhlbihcbiAgICAgICAgICAgIChyZXN1bHQ6IEFycmF5PE9mZmVyPikgPT4ge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5mb3JFYWNoKHIgPT4gcGxhY2VNYXJrZXIociwgbWFwKSlcbiAgICAgICAgICAgICAgICB2bS5mZXRjaGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHZtLmZldGNoaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbn1cblxuZnVuY3Rpb24gcGxhY2VNYXJrZXIob2ZmZXI6IE9mZmVyLCBtYXBWaWV3OiBNYXBWaWV3KSB7XG4gICAgdmFyIG1hcmtlciA9IG5ldyBNYXJrZXJDdXN0b20oKTtcbiAgICBtYXJrZXIucG9zaXRpb24gPSBQb3NpdGlvbi5wb3NpdGlvbkZyb21MYXRMbmcob2ZmZXIubG9jYXRpb24ubGF0LCBvZmZlci5sb2NhdGlvbi5sbmcpO1xuICAgIG1hcmtlci50aXRsZSA9IG9mZmVyLnRpdGxlO1xuICAgIG1hcmtlci5zbmlwcGV0ID0gb2ZmZXIuZGVzY3JpcHRpb247XG4gICAgLy8gbWFya2VyLnVzZXJEYXRhID0geyBpbmRleCA6IDF9O1xuXG4gICAgbWFwVmlldy5hZGRNYXJrZXIobWFya2VyKTtcbn1cblxuIl19